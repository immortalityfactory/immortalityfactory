# 语言切换功能说明

## URL 结构

项目使用 `next-intl` 实现多语言，配置为 `localePrefix: 'always'`，所有语言都有明确的 URL 前缀：

```
/           → 自动跳转到 /en (默认英文)
/en         → 英文版本
/zh         → 中文版本
```

## 用户体验流程

### 1. 首次访问
```
用户访问 https://your-domain.com
    ↓
显示 "Loading..." 页面（瞬间）
    ↓
自动跳转到 https://your-domain.com/en
    ↓
显示英文版游戏页面
```

### 2. 切换语言
```
用户在英文页面点击 "中文" 按钮
    ↓
跳转到 https://your-domain.com/zh
    ↓
显示中文版游戏页面（保持在同一页面）
```

### 3. 直接访问特定语言
```
用户可以直接访问：
- https://your-domain.com/en  (英文)
- https://your-domain.com/zh  (中文)
```

## 技术实现

### 1. 根路径重定向 (`src/app/page.tsx`)

```typescript
'use client'
import { useEffect } from 'react'
import { useRouter } from 'next/navigation'
import { routing } from '@/i18n/routing'

export default function RootPage() {
  const router = useRouter()
  
  useEffect(() => {
    // 重定向到默认语言（不检测浏览器语言）
    router.replace(`/${routing.defaultLocale}`)
  }, [router])

  return (
    <div className="min-h-screen flex items-center justify-center bg-black">
      <div className="text-primary font-pixel text-lg">Loading...</div>
    </div>
  )
}
```

**特点：**
- ✅ 不自动检测浏览器语言
- ✅ 始终跳转到默认语言（英文）
- ✅ 用户可以主动切换语言

### 2. 语言切换器 (`src/components/LanguageSwitcher.tsx`)

```typescript
const switchLocale = (newLocale: Locale) => {
  // 获取当前路径（去除语言前缀）
  const segments = pathname.split('/').filter(Boolean)
  const isCurrentLocaleInPath = segments[0] === currentLocale
  const pathWithoutLocale = isCurrentLocaleInPath 
    ? segments.slice(1).join('/') 
    : segments.join('/')
  
  // 构建新路径 - 所有语言都使用前缀
  router.push(`/${newLocale}${pathWithoutLocale ? `/${pathWithoutLocale}` : ''}`)
}
```

**特点：**
- ✅ 保持当前页面路径
- ✅ 只改变语言前缀
- ✅ 按钮显示当前语言状态（高亮）

### 3. 路由配置 (`src/i18n/routing.ts`)

```typescript
export const routing = defineRouting({
  locales: ['en', 'zh'],
  defaultLocale: 'en',
  localePrefix: 'always'  // 所有语言都使用前缀
})
```

## 为什么选择这个方案？

### ✅ 优势

1. **URL 清晰明确**
   - 每个语言都有独立的 URL
   - SEO 友好，搜索引擎可以索引不同语言版本

2. **用户控制权**
   - 不强制检测浏览器语言
   - 用户可以自主选择语言
   - 符合国际化最佳实践

3. **开发维护简单**
   - 路由规则统一（都有前缀）
   - 静态导出兼容性好
   - 易于添加新语言

4. **分享友好**
   - URL 可以准确表示语言版本
   - 分享链接时保持语言设置

### ❌ 不使用浏览器语言自动检测的原因

1. **用户体验问题**
   - 有些用户浏览器设置不准确
   - VPN 或代理可能导致误判
   - 强制跳转会让用户困惑

2. **技术限制**
   - 静态导出不支持服务器端语言检测
   - 客户端检测会有闪烁
   - Cookie/LocalStorage 管理复杂

3. **国际标准**
   - 大多数网站（Google、GitHub 等）默认显示一种语言
   - 提供明显的语言切换按钮
   - 记住用户选择（可选功能）

## 未来优化方向

### 1. 记住用户语言偏好

可以添加 LocalStorage 来记住用户选择：

```typescript
useEffect(() => {
  const savedLocale = localStorage.getItem('preferred-locale')
  if (savedLocale && savedLocale !== currentLocale) {
    router.replace(`/${savedLocale}`)
  }
}, [])

const switchLocale = (newLocale: Locale) => {
  localStorage.setItem('preferred-locale', newLocale)
  router.push(`/${newLocale}`)
}
```

### 2. 首次访问时的语言提示

可以添加一个小提示条：

```
[i] 您似乎使用中文浏览器，是否切换到中文版？ [切换] [保持英文]
```

### 3. 添加更多语言

只需三步：
1. 在 `src/i18n/locales/` 添加新的翻译文件（如 `ja.json`）
2. 在 `src/i18n/config.ts` 添加 `'ja'` 到 locales 数组
3. 在 `LanguageSwitcher.tsx` 的 `getLanguageName` 添加显示名称

## 测试清单

- [ ] 访问 `/` 自动跳转到 `/en`
- [ ] 在英文页面点击 "中文" 按钮跳转到 `/zh`
- [ ] 在中文页面点击 "EN" 按钮跳转到 `/en`
- [ ] 直接访问 `/en` 显示英文内容
- [ ] 直接访问 `/zh` 显示中文内容
- [ ] 当前语言按钮高亮显示
- [ ] 构建后静态文件正常工作

