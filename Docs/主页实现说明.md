# 主页实现说明

## 架构概述

项目现在支持三个路由，显示相同的游戏内容，只是语言不同：

```
/           → 英文游戏主页（不跳转）
/en         → 英文游戏页面
/zh         → 中文游戏页面
```

## 技术实现

### 1. 共享组件架构

```
src/
├── components/
│   ├── GamePage.tsx           # 共享的游戏页面组件
│   ├── GameEmbed.tsx          # 游戏嵌入组件（支持翻译 props）
│   └── LanguageSwitcher.tsx   # 语言切换器（支持所有路由）
└── app/
    ├── page.tsx               # 根路径（硬编码英文）
    └── [locale]/
        └── page.tsx           # 语言路径（使用 next-intl）
```

### 2. GamePage 组件（核心）

**位置**：`src/components/GamePage.tsx`

**功能**：
- 接收所有翻译文本作为 props
- 不依赖 `next-intl` context
- 可以在任何路由中使用

**Props 接口**：
```typescript
interface GamePageProps {
  translations: {
    subtitle: string
    playNow: string
    description: string
    playtime: string
    controls: string
    storyTitle: string
    storyParagraph1: string
    storyParagraph2: string
    featuresTitle: string
    feature1: string
    feature2: string
    feature3: string
    feature4: string
    loading: string
    fullscreen: string
    exitFullscreen: string
  }
}
```

### 3. 根路径实现（`/`）

**位置**：`src/app/page.tsx`

**特点**：
- 客户端组件（`'use client'`）
- 硬编码英文翻译
- 不依赖 `next-intl`
- 可以被静态导出

**代码**：
```typescript
export default function RootPage() {
  return (
    <GamePage
      translations={{
        subtitle: 'A Factory-Building Incremental Game',
        playNow: 'Play Now',
        // ... 其他英文翻译
      }}
    />
  )
}
```

### 4. 语言路径实现（`/en`, `/zh`）

**位置**：`src/app/[locale]/page.tsx`

**特点**：
- 客户端组件（`'use client'`）
- 使用 `next-intl` 的 `useTranslations`
- 从 JSON 文件读取翻译
- 支持动态语言切换

**代码**：
```typescript
export default function LocalePage() {
  const t = useTranslations('game')
  
  return (
    <GamePage
      translations={{
        subtitle: t('subtitle'),
        playNow: t('playNow'),
        // ... 从 JSON 读取翻译
      }}
    />
  )
}
```

### 5. GameEmbed 组件改造

**位置**：`src/components/GameEmbed.tsx`

**改动**：
- 添加可选的 `translations` prop
- 提供默认英文翻译作为 fallback
- 不再直接使用 `useTranslations`

**原因**：
- 根路径没有 `next-intl` context
- 需要支持在任何环境下使用

### 6. LanguageSwitcher 改进

**位置**：`src/components/LanguageSwitcher.tsx`

**特点**：
- 不依赖 `useLocale()` hook
- 通过 `usePathname()` 判断当前语言
- 支持根路径和语言路径的切换

**逻辑**：
```typescript
// 根据 URL 路径判断当前语言
const segments = pathname.split('/').filter(Boolean)
const firstSegment = segments[0]

if (locales.includes(firstSegment)) {
  // /en 或 /zh
  setCurrentLocale(firstSegment)
} else {
  // / (根路径)
  setCurrentLocale('en')
}
```

**切换逻辑**：
```typescript
// 切换到英文：跳转到 /
// 切换到中文：跳转到 /zh
if (newLocale === 'en') {
  router.push('/')
} else {
  router.push(`/${newLocale}`)
}
```

## URL 路由策略

### 配置：`localePrefix: 'as-needed'`

```typescript
// src/i18n/routing.ts
export const routing = defineRouting({
  locales: ['en', 'zh'],
  defaultLocale: 'en',
  localePrefix: 'as-needed'  // 默认语言不需要前缀
})
```

### 路由映射

| URL | 显示内容 | 实现方式 |
|-----|---------|---------|
| `/` | 英文游戏页面 | `app/page.tsx` (硬编码) |
| `/en` | 英文游戏页面 | `app/[locale]/page.tsx` (next-intl) |
| `/zh` | 中文游戏页面 | `app/[locale]/page.tsx` (next-intl) |

### 为什么有两个英文页面？

1. **根路径 `/`**：
   - 用户首次访问的入口
   - 不需要跳转，立即显示内容
   - 硬编码翻译，快速渲染
   - SEO 友好（根路径权重高）

2. **语言路径 `/en`**：
   - 用户主动切换语言后的路径
   - 使用 next-intl 管理翻译
   - 便于添加更多英文翻译变体
   - URL 明确表示语言

## 用户体验流程

### 首次访问
```
用户访问 https://your-domain.com/
    ↓
直接显示英文游戏页面（无跳转）
    ↓
用户看到语言切换按钮：[EN] [中文]
    ↓
EN 按钮高亮（表示当前语言）
```

### 切换到中文
```
用户点击 "中文" 按钮
    ↓
URL 变为 https://your-domain.com/zh
    ↓
页面重新渲染为中文内容
    ↓
中文按钮高亮
```

### 切换回英文
```
用户点击 "EN" 按钮
    ↓
URL 变为 https://your-domain.com/
    ↓
页面重新渲染为英文内容
    ↓
EN 按钮高亮
```

### 直接访问语言页面
```
用户访问 https://your-domain.com/zh
    ↓
直接显示中文游戏页面
    ↓
中文按钮高亮
```

## 代码维护

### 添加新的翻译文本

1. **更新 GamePage Props**：
```typescript
// src/components/GamePage.tsx
interface GamePageProps {
  translations: {
    // ... 现有字段
    newField: string  // 添加新字段
  }
}
```

2. **更新根路径**：
```typescript
// src/app/page.tsx
<GamePage
  translations={{
    // ... 现有翻译
    newField: 'New English Text',
  }}
/>
```

3. **更新语言路径**：
```typescript
// src/app/[locale]/page.tsx
<GamePage
  translations={{
    // ... 现有翻译
    newField: t('newField'),
  }}
/>
```

4. **更新翻译文件**：
```json
// src/i18n/locales/en.json
{
  "game": {
    "newField": "New English Text"
  }
}

// src/i18n/locales/zh.json
{
  "game": {
    "newField": "新的中文文本"
  }
}
```

### 添加新语言（如日语）

1. 创建翻译文件：
```bash
touch src/i18n/locales/ja.json
```

2. 添加日语翻译：
```json
{
  "game": {
    "subtitle": "工場建設インクリメンタルゲーム",
    ...
  }
}
```

3. 更新配置：
```typescript
// src/i18n/config.ts
export const locales = ['en', 'zh', 'ja'] as const
```

4. 更新语言切换器：
```typescript
// src/components/LanguageSwitcher.tsx
const getLanguageName = (loc: Locale) => {
  const names: Record<Locale, string> = {
    en: 'EN',
    zh: '中文',
    ja: '日本語'  // 添加
  }
  return names[loc]
}
```

5. 完成！现在 `/ja` 路由自动可用

## 优势总结

### ✅ 用户体验
- 首次访问无跳转，立即看到内容
- 语言切换清晰直观
- URL 可分享，语言固定

### ✅ SEO 优化
- 根路径权重高
- 每个语言独立 URL
- 静态 HTML，爬虫友好

### ✅ 开发维护
- 代码高度复用
- 翻译集中管理
- 易于添加新语言

### ✅ 技术架构
- 支持静态导出
- 不依赖服务器端渲染
- 兼容 CDN 部署

## 测试清单

- [x] 访问 `/` 显示英文内容
- [x] 访问 `/en` 显示英文内容
- [x] 访问 `/zh` 显示中文内容
- [x] 在 `/` 点击 "中文" 跳转到 `/zh`
- [x] 在 `/zh` 点击 "EN" 跳转到 `/`
- [x] 在 `/en` 点击 "中文" 跳转到 `/zh`
- [x] 当前语言按钮正确高亮
- [x] 游戏嵌入组件正常工作
- [x] 全屏按钮正常工作
- [x] 构建成功，生成静态文件

