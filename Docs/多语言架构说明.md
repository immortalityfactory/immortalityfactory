# 多语言架构说明

## 当前架构（推荐）

### 文件结构
```
src/app/
├── layout.tsx              # 根布局（包含 <html> 和 <body>）
├── page.tsx                # 根路由重定向
└── [locale]/               # 动态语言路由
    ├── layout.tsx          # 语言特定布局（配置 next-intl）
    └── page.tsx            # 主页面内容
```

### 路由映射
- `/` → 自动显示默认语言（英文）
- `/zh` → 显示中文版本
- 其他语言可以轻松添加（如 `/ja`, `/ko` 等）

### 技术优势

#### 1. **自动语言检测和路由**
- next-intl 自动处理 URL 路径中的语言参数
- 无需手动传递 'en' 或 'zh' 参数
- 支持浏览器语言自动检测

#### 2. **类型安全**
```typescript
const t = useTranslations('game')
// TypeScript 会自动推断翻译键的类型
t('subtitle')  // ✅ 类型安全
t('invalidKey') // ❌ TypeScript 报错
```

#### 3. **SEO 友好**
- 每个语言版本有独立的 URL（`/`, `/zh`）
- 搜索引擎可以正确索引不同语言版本
- 自动生成 `hreflang` 标签

#### 4. **代码复用**
- 所有语言共享同一个组件代码（`[locale]/page.tsx`）
- 翻译文本统一管理在 `i18n/locales/*.json`
- 无需为每个语言创建重复页面

#### 5. **易于扩展**
添加新语言只需三步：
1. 在 `i18n/locales/` 添加新的翻译文件（如 `ja.json`）
2. 在 `i18n/routing.ts` 的 `locales` 数组添加 `'ja'`
3. 完成！无需修改任何组件代码

## ❌ 不推荐的方案

### 方案：抽取公共组件，手动传入语言参数

```typescript
// ❌ 不推荐
// src/app/page.tsx
<SharedPage locale="en" />

// src/app/zh/page.tsx  
<SharedPage locale="zh" />
```

### 问题

#### 1. **违背 Next.js 最佳实践**
- Next.js 推荐使用动态路由处理参数化内容
- 手动传参会丢失框架的自动优化

#### 2. **类型安全性差**
```typescript
// locale 参数可能传错，运行时才发现错误
<SharedPage locale="cn" /> // 应该是 'zh' 而不是 'cn'
```

#### 3. **SEO 问题**
- 需要手动配置每个语言版本的 metadata
- 容易遗漏或配置错误

#### 4. **代码重复**
- 每个语言需要创建单独的路由文件
- 增加维护成本

#### 5. **扩展性差**
- 添加新语言需要：
  - 创建新的路由文件
  - 手动传递正确的语言参数
  - 更新所有相关配置

## 当前架构的工作原理

### 1. 根布局（`app/layout.tsx`）
```typescript
export default function RootLayout({ children }) {
  return (
    <html suppressHydrationWarning>
      <body>{children}</body>
    </html>
  )
}
```
- 提供基础的 HTML 结构
- `suppressHydrationWarning` 避免因语言属性不匹配导致的警告

### 2. 语言布局（`app/[locale]/layout.tsx`）
```typescript
export default async function LocaleLayout({
  children,
  params,
}) {
  const { locale } = await params
  const messages = await getMessages({ locale })

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```
- 嵌套的 `<html>` 和 `<body>` 会覆盖父级的
- 设置正确的 `lang` 属性
- 提供翻译上下文

### 3. 页面组件（`app/[locale]/page.tsx`）
```typescript
export default function HomePage() {
  const t = useTranslations('game')
  
  return (
    <main>
      <h1>{t('subtitle')}</h1>
      {/* 自动使用当前路由的语言 */}
    </main>
  )
}
```
- 使用 `useTranslations` 获取翻译函数
- 无需关心当前是哪个语言
- next-intl 自动处理

## 结论

**保持当前的 `[locale]` 动态路由架构**，它是：
- ✅ Next.js 官方推荐的多语言方案
- ✅ next-intl 的标准用法
- ✅ 类型安全、SEO 友好
- ✅ 易于维护和扩展
- ✅ 代码简洁，无重复

手动传参的方案虽然直观，但会失去框架提供的所有优化和便利性。

